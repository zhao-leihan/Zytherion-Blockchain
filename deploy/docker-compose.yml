services:
  zytherion-node:
    build:
      context: ..
      dockerfile: deploy/Dockerfile.node
    ports:
      - "8545:8545"
      - "30303:30303"
    volumes:
      - node-data:/root/data
      - ./block-logs:/root/data:rw  # Mount host directory for logs
    environment:
      - NETWORK=testnet
    command: ["./zytherion-node", "--mine", "--validator", "--datadir", "./data", "--aivalidator", "http://ai-validator:5000"]
    networks:
      - zytherion-net

  ai-validator:
    build:
      context: ..
      dockerfile: deploy/Dockerfile.ai
    ports:
      - "5000:5000"
    volumes:
      - ai-models:/app/models
      - ./block-logs:/app/data:rw  # Share the same log directory
    environment:
      - API_HOST=0.0.0.0
      - API_PORT=5000
    networks:
      - zytherion-net

  monitor:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin
    volumes:
      - grafana-data:/var/lib/grafana
      - ./block-logs:/var/lib/grafana/block-logs:ro  # Read logs for monitoring
    networks:
      - zytherion-net

networks:
  zytherion-net:
    driver: bridge

volumes:
  node-data:
  ai-models:
  grafana-data: