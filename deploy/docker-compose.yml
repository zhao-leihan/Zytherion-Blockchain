version: '3.8'

services:
  # Zytherion Core Node
  zytherion-node:
    build:
      context: ..
      dockerfile: deploy/Dockerfile.node
    ports:
      - "8545:8545"  # RPC
      - "30303:30303" # P2P
    volumes:
      - node-data:/root/data
    environment:
      - NETWORK=mainnet
      - RPC_PORT=8545
      - P2P_PORT=30303
    command: ["--mine", "--validator"]
    networks:
      - zytherion-net

  # AI Validator Service
  ai-validator:
    build:
      context: ..
      dockerfile: deploy/Dockerfile.ai
    ports:
      - "5000:5000"
    volumes:
      - ai-models:/app/models
    environment:
      - MODEL_PATH=/app/models/block_validator.h5
      - API_HOST=0.0.0.0
      - API_PORT=5000
    networks:
      - zytherion-net

  # Monitoring Dashboard
  monitor:
    image: grafana/grafana:latest
    ports:
      - "3000:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
      - GF_SECURITY_ADMIN_USER=admin
    volumes:
      - grafana-data:/var/lib/grafana
    networks:
      - zytherion-net

networks:
  zytherion-net:
    driver: bridge

volumes:
  node-data:
  ai-models:
  grafana-data: